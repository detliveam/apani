<?php
include "koneksi.php";


if (isset($_POST['simpan'])) {
    $username = $_POST['username'];
    $password = $_POST['password'];
    $role     = $_POST['role'];
    $id       = $_POST['id_user'];

    if ($id == "") {
        mysqli_query($conn,
            "INSERT INTO pengguna (username, password, role)
             VALUES ('$username','$password','$role')"
        );
    } else {
        mysqli_query($conn,
            "UPDATE pengguna 
             SET username='$username',
                 password='$password',
                 role='$role'
             WHERE id_user='$id'"
        );
    }

    header("location: pengguna.php");
    exit;
}


if (isset($_GET['hapus'])) {
    $id = $_GET['hapus'];
    mysqli_query($conn, "DELETE FROM pengguna WHERE id_user='$id'");
    header("location: pengguna.php");
    exit;
}


$edit = false;
$id_user = "";
$username = "";
$password = "";
$role = "";

if (isset($_GET['edit'])) {
    $edit = true;
    $id_user = $_GET['edit'];

    $data = mysqli_query($conn,
        "SELECT * FROM pengguna WHERE id_user='$id_user'"
    );
    $d = mysqli_fetch_array($data);

    if ($d) {
        $username = $d['username'];
        $password = $d['password'];
        $role     = $d['role'];
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Pengguna</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    background: #f4f4f4;
}


.navbar {
    width: 220px;
    height: 100vh;
    background: #000;
    position: fixed;
    left: 0;
    top: 0;
    padding-top: 20px;
}

.navbar a {
    display: block;
    color: #fff;
    text-decoration: none;
    padding: 12px 20px;
}

.navbar a:hover {
    background: #333;
}
.navbar h2 {
    color: #fff;
}



.container {
    margin-left: 220px; 
    padding: 30px;
}


form {
    background: #fff;
    width: 400px;
    margin: 0 auto 30px auto;
    padding: 20px;
    border-radius: 5px;
}

form label {
    display: block;
    margin-top: 10px;
}

form input, form select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

form button {
    margin-top: 15px;
    padding: 10px;
    width: 100%;
    background: #0ab9ff;
    color: #fff;
    border: none;
    cursor: pointer;
}

form button:hover {
    background: #333;
}


table {
    background: #fff;
    width: 80%;
    margin: 0 auto;
    border-collapse: collapse;
}

table th, table td {
    padding: 10px;
    text-align: center;
}

table th {
    background: #0ab9ff;
    color: #fff;
}

table tr:nth-child(even) {
    background: #eee;
}

table a {
    text-decoration: none;
    color: #000;
}
</style>

</head>
<body>

<div class="navbar">
     <center><h2> Laundry </h2></center>
    <a href="dashboard.php">Dashboard</a>
    <a href="outlet.php">Outlet</a>
    <a href="paket.php">Paket</a>
    <a href="pengguna.php">Pengguna</a>
    <a href="pelanggan.php">Pelanggan</a>
    <a href="transaksi.php">Transaksi</a>
    <a href="logout.php">Logout</a>
</div>

<div class="container">
    <h2>Input Pengguna</h2>

    <form method="POST">
        <input type="hidden" name="id_user" value="<?= $id_user ?>">

        <label>Username</label>
        <input type="text" name="username" value="<?= $username ?>" required>

        <label>Password</label>
        <input type="text" name="password" value="<?= $password ?>" required>

        <label>Role</label>
        <select name="role" required>
            <option value="">-- Pilih Role --</option>
            <option value="admin" <?= $role=="admin"?"selected":"" ?>>Admin</option>
            <option value="kasir" <?= $role=="kasir"?"selected":"" ?>>Kasir</option>
            <option value="owner" <?= $role=="owner"?"selected":"" ?>>Owner</option>
        </select>

        <button type="submit" name="simpan">
            <?= $edit ? "Update" : "Simpan" ?>
        </button>

        <?php if ($edit) { ?>
            <a href="pengguna.php">Batal</a>
        <?php } ?>
    </form>

    <table border="1">
        <tr>
            <th>No</th>
            <th>Username</th>
            <th>Password</th>
            <th>Role</th>
            <th>Aksi</th>
        </tr>

        <?php
        $no = 1;
        $data = mysqli_query($conn,"SELECT * FROM pengguna");
        while ($d = mysqli_fetch_array($data)) {
        ?>
        <tr>
            <td><?= $no++ ?></td>
            <td><?= $d['username'] ?></td>
            <td><?= $d['password'] ?></td>
            <td><?= $d['role'] ?></td>
            <td>
                <a href="pengguna.php?edit=<?= $d['id_user'] ?>">Edit</a> |
                <a href="pengguna.php?hapus=<?= $d['id_user'] ?>"
                   onclick="return confirm('Yakin hapus?')">Hapus</a>
            </td>
        </tr>
        <?php } ?>
    </table>
</div>

</body>
</html>
